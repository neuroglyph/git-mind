#!/usr/bin/env bash
# Wrapper to choose between quick and full CI checks

# Use GITMIND_PUSH_MODE environment variable or default to "smart"
# Options: quick, full, smart
MODE="${GITMIND_PUSH_MODE:-smart}"

# In smart mode, only run full CI for main/dev branches
if [[ "$MODE" == "smart" ]]; then
    # Check if we're pushing to main or dev
    while read local_ref local_sha remote_ref remote_sha; do
        if [[ "$remote_ref" =~ ^refs/heads/(main|dev|master)$ ]]; then
            MODE="full"
            break
        else
            MODE="quick"
        fi
    done
fi

case "$MODE" in
    quick)
        echo "üìù Using quick mode (set GITMIND_PUSH_MODE=full for complete CI)"
        exec "$(dirname "$0")/pre-push-quick" "$@"
        ;;
    full)
        exec "$(dirname "$0")/pre-push-full" "$@"
        ;;
    *)
        echo "‚ùå Unknown GITMIND_PUSH_MODE: $MODE (use: quick, full, or smart)"
        exit 1
        ;;
esac